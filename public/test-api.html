<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Google Sheets API Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
        }
        button {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 5px;
        }
        button:hover {
            background: #45a049;
        }
        .error {
            background: #ffebee;
            border-left: 4px solid #f44336;
            padding: 15px;
            margin: 15px 0;
        }
        .success {
            background: #e8f5e9;
            border-left: 4px solid #4CAF50;
            padding: 15px;
            margin: 15px 0;
        }
        pre {
            background: #f5f5f5;
            padding: 15px;
            border-radius: 4px;
            overflow-x: auto;
        }
        .info {
            background: #e3f2fd;
            border-left: 4px solid #2196F3;
            padding: 15px;
            margin: 15px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîß Google Sheets API Diagnostic Tool</h1>
        
        <div class="info">
            <strong>Testing Connection To:</strong><br>
            Spreadsheet ID: 1775CUAh2xcbZiWF-_9ApU0G17erA2TiT2ARaKdllLSs<br>
            Sheet ID: 1833505822<br>
            API Key: AIzaSyBVdUjKAsMG-Mf_SMTSkP_n6Vi9PNxVm1w
        </div>

        <button onclick="testMetadata()">1. Test Metadata Access</button>
        <button onclick="testDataAccess()">2. Test Data Access</button>
        <button onclick="testCSVExport()">3. Test CSV Export</button>
        <button onclick="clearResults()">Clear Results</button>

        <div id="results"></div>
    </div>

    <script>
        const API_KEY = 'AIzaSyBVdUjKAsMG-Mf_SMTSkP_n6Vi9PNxVm1w';
        const SPREADSHEET_ID = '1775CUAh2xcbZiWF-_9ApU0G17erA2TiT2ARaKdllLSs';
        const SHEET_ID = '1833505822';

        function clearResults() {
            document.getElementById('results').innerHTML = '';
        }

        function addResult(html) {
            document.getElementById('results').innerHTML += html;
        }

        async function testMetadata() {
            addResult('<h3>Testing Metadata Access...</h3>');
            try {
                const url = `https://sheets.googleapis.com/v4/spreadsheets/${SPREADSHEET_ID}?key=${API_KEY}`;
                console.log('Fetching:', url);
                
                const response = await fetch(url);
                const data = await response.json();
                
                if (response.ok) {
                    addResult(`
                        <div class="success">
                            <strong>‚úÖ Success!</strong> Metadata loaded successfully.<br>
                            Spreadsheet Title: ${data.properties.title}<br>
                            Number of Sheets: ${data.sheets.length}
                        </div>
                    `);
                    
                    const sheet = data.sheets.find(s => s.properties.sheetId === parseInt(SHEET_ID));
                    if (sheet) {
                        addResult(`
                            <div class="success">
                                <strong>‚úÖ Sheet Found!</strong><br>
                                Sheet Name: ${sheet.properties.title}<br>
                                Rows: ${sheet.properties.gridProperties.rowCount}<br>
                                Columns: ${sheet.properties.gridProperties.columnCount}
                            </div>
                        `);
                    } else {
                        addResult(`<div class="error"><strong>‚ùå Sheet ID ${SHEET_ID} not found in spreadsheet</strong></div>`);
                    }
                    
                    addResult(`<pre>${JSON.stringify(data, null, 2)}</pre>`);
                } else {
                    addResult(`
                        <div class="error">
                            <strong>‚ùå Failed to load metadata</strong><br>
                            Status: ${response.status} ${response.statusText}<br>
                            Error: ${data.error?.message || 'Unknown error'}<br><br>
                            <strong>Solution:</strong> Make sure the Google Sheet is shared publicly!
                        </div>
                    `);
                    addResult(`<pre>${JSON.stringify(data, null, 2)}</pre>`);
                }
            } catch (error) {
                addResult(`<div class="error"><strong>‚ùå Error:</strong> ${error.message}</div>`);
            }
        }

        async function testDataAccess() {
            addResult('<h3>Testing Data Access...</h3>');
            try {
                // First get the sheet name
                const metadataUrl = `https://sheets.googleapis.com/v4/spreadsheets/${SPREADSHEET_ID}?key=${API_KEY}`;
                const metadataResponse = await fetch(metadataUrl);
                const metadata = await metadataResponse.json();
                
                if (!metadataResponse.ok) {
                    addResult(`<div class="error"><strong>‚ùå Failed to get metadata.</strong> Cannot proceed without sheet name.</div>`);
                    return;
                }
                
                const sheet = metadata.sheets.find(s => s.properties.sheetId === parseInt(SHEET_ID));
                if (!sheet) {
                    addResult(`<div class="error"><strong>‚ùå Sheet not found</strong></div>`);
                    return;
                }
                
                const sheetName = sheet.properties.title;
                const range = `${sheetName}!A:Z`;
                const dataUrl = `https://sheets.googleapis.com/v4/spreadsheets/${SPREADSHEET_ID}/values/${encodeURIComponent(range)}?key=${API_KEY}`;
                
                console.log('Fetching data from:', dataUrl);
                
                const response = await fetch(dataUrl);
                const data = await response.json();
                
                if (response.ok) {
                    addResult(`
                        <div class="success">
                            <strong>‚úÖ Success!</strong> Data loaded successfully.<br>
                            Total Rows: ${data.values?.length || 0}<br>
                            First Row (Headers): ${data.values?.[0]?.join(', ') || 'None'}
                        </div>
                    `);
                    
                    if (data.values && data.values.length > 1) {
                        addResult(`
                            <div class="success">
                                <strong>Sample Data (First 3 rows):</strong>
                                <pre>${JSON.stringify(data.values.slice(0, 3), null, 2)}</pre>
                            </div>
                        `);
                    }
                } else {
                    addResult(`
                        <div class="error">
                            <strong>‚ùå Failed to load data</strong><br>
                            Status: ${response.status} ${response.statusText}<br>
                            Error: ${data.error?.message || 'Unknown error'}
                        </div>
                    `);
                    addResult(`<pre>${JSON.stringify(data, null, 2)}</pre>`);
                }
            } catch (error) {
                addResult(`<div class="error"><strong>‚ùå Error:</strong> ${error.message}</div>`);
            }
        }

        async function testCSVExport() {
            addResult('<h3>Testing CSV Export...</h3>');
            try {
                const csvUrl = `https://docs.google.com/spreadsheets/d/${SPREADSHEET_ID}/export?format=csv&gid=${SHEET_ID}`;
                console.log('Fetching CSV from:', csvUrl);
                
                const response = await fetch(csvUrl);
                const text = await response.text();
                
                if (response.ok && !text.includes('<!DOCTYPE')) {
                    const lines = text.split('\n');
                    addResult(`
                        <div class="success">
                            <strong>‚úÖ Success!</strong> CSV export works!<br>
                            Total Lines: ${lines.length}<br>
                            Headers: ${lines[0]}
                        </div>
                    `);
                    addResult(`
                        <div class="success">
                            <strong>First 5 lines:</strong>
                            <pre>${lines.slice(0, 5).join('\n')}</pre>
                        </div>
                    `);
                } else {
                    addResult(`
                        <div class="error">
                            <strong>‚ùå CSV export failed</strong><br>
                            The sheet is likely not publicly accessible.<br><br>
                            <strong>Solution:</strong><br>
                            1. Open your Google Sheet<br>
                            2. Click Share button<br>
                            3. Set "Anyone with the link" ‚Üí "Viewer"<br>
                            4. Try again
                        </div>
                    `);
                }
            } catch (error) {
                addResult(`<div class="error"><strong>‚ùå Error:</strong> ${error.message}</div>`);
            }
        }

        // Auto-run first test on load
        window.addEventListener('load', () => {
            addResult('<div class="info"><strong>üí° Click the buttons above to test different access methods</strong></div>');
        });
    </script>
</body>
</html>
